import{a as P}from"./chunk-QDLDUTZF.js";import{a as T,b as Y}from"./chunk-CMT3EP5V.js";import{Bb as D,Bc as A,Cb as $,Db as j,Dd as I,E as v,Fd as R,Hd as f,Ia as p,Ib as d,J as c,Mb as o,Nd as M,O as g,Qa as O,Qc as k,Ra as w,Xa as z,Ya as x,a as u,da as E,ea as _,eb as S,g as C,gb as N,ha as r,m as y,ob as l,ra as b}from"./chunk-5WYQ2NZI.js";var a=class n{cogSrv=r(R);lazySrv=r(I);_cog;loading=!1;loaded=!1;notify$=new y;get cog(){return this._cog}set cog(t){this._cog=this.cogSrv.merge("chart",{theme:"",echartsLib:"https://cdnjs.cloudflare.com/ajax/libs/echarts/5.1.0/echarts.min.js"},t)}constructor(){this.cog={theme:""}}libLoad(){return this.loading?(this.loaded&&this.notify$.next(),this):(this.loading=!0,this.lazySrv.load(this.cog.echartsLib).then(()=>{let t=this.cog.echartsExtensions;return Array.isArray(t)&&t.length>0?this.lazySrv.load(t).then(()=>!0):Promise.resolve(!0)}).then(()=>{this.loaded=!0,this.notify$.next()}),this)}get notify(){return this.notify$.asObservable()}ngOnDestroy(){this.notify$.unsubscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=E({token:n,factory:n.\u0275fac,providedIn:"root"})};var Z=["container"];function q(n,t){n&1&&(o(0,`
      `),l(1,"nz-skeleton"),o(2,`
    `))}var s=class s{srv=r(a);cdr=r(A);ngZone=r(x);platform=r(M);node;destroy$=r(b);_chart=null;_theme;_initOpt;_option;_width="100%";_height="400px";set width(t){this._width=typeof t=="number"?`${t}px`:`${t}`}set height(t){this._height=typeof t=="number"?`${t}px`:`${t}`}set theme(t){this._theme=t,this._chart&&this.install()}set initOpt(t){this._initOpt=t,this._chart&&this.install()}set option(t){this._option=t,this._chart&&this.setOption(t,!0)}on=[];events=new z;get chart(){return this._chart}loaded=!1;constructor(){this.srv.notify.pipe(f(),c(()=>!this.loaded)).subscribe(()=>this.load()),this.theme=this.srv.cog.echartsTheme}emit(t,e){this.events.emit(u({type:t,chart:this.chart},e))}load(){this.ngZone.run(()=>{this.loaded=!0,this.cdr.detectChanges()}),this.emit("ready"),this.install()}install(){this.destroy();let t=this._chart=window.echarts.init(this.node.nativeElement,this._theme,this._initOpt);return this.emit("init"),this.setOption(this._option),this.on.forEach(e=>{e.query!=null?t.on(e.eventName,e.query,i=>e.handler({event:i,chart:t})):t.on(e.eventName,i=>e.handler({event:i,chart:t}))}),this}destroy(){return this._chart&&(this._chart.dispose(),this.emit("destroy")),this}setOption(t,e=!1,i=!1){return this._chart&&(this._chart.setOption(t,e,i),this.emit("set-option",{option:t})),this}ngOnInit(){this.platform.isBrowser&&(window.echarts?this.load():this.srv.libLoad(),v(window,"resize").pipe(f(this.destroy$),c(()=>!!this._chart),g(200)).subscribe(()=>this._chart.resize()))}ngOnDestroy(){this.on.forEach(t=>this._chart?.off(t.eventName)),this.destroy()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=O({type:s,selectors:[["chart-echarts"],["","chart-echarts",""]],viewQuery:function(e,i){if(e&1&&D(Z,7),e&2){let m;$(m=j())&&(i.node=m.first)}},hostVars:6,hostBindings:function(e,i){e&2&&d("display","inline-block")("width",i._width)("height",i._height)},inputs:{width:"width",height:"height",theme:"theme",initOpt:"initOpt",option:"option",on:"on"},outputs:{events:"events"},exportAs:["chartECharts"],decls:5,vars:5,consts:[["container",""]],template:function(e,i){e&1&&(o(0,`
    `),S(1,q,3,0),l(2,"div",null,0),o(4,`
  `)),e&2&&(p(),N(i.loaded?-1:1),p(),d("width",i._width)("height",i._height))},dependencies:[T],encapsulation:2,changeDetection:0})};C([P()],s.prototype,"load",1);var h=s;var B=[h],Q=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=w({type:n});static \u0275inj=_({imports:[k,Y,B]})};export{h as a,Q as b};
